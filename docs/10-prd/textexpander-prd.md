# TextExpander 제품 스펙 (PRD - Product Requirements Document)

## 1. 개요

**TextExpander**는 Windows에서 동작하는 전역 텍스트 확장 유틸리티입니다.

- **핵심 기능**: 사용자가 짧은 키워드(예: `;addr`, `;sig`)를 입력한 뒤 구분자(스페이스/엔터/구두점)를 누르면, 미리 정의한 대체 텍스트로 자동으로 치환합니다.
- **목표**: 반복적인 타이핑을 줄이고, 주소, 이메일 서명, 자주 쓰는 문장 등을 빠르게 입력할 수 있도록 돕습니다.
- **타깃**: Windows 10/11 사용자

---

## 2. 기술 스택 & 환경

| 항목 | 값 |
|------|-----|
| OS | Windows 10, 11 |
| 언어 | C# |
| 런타임 | .NET 8 |
| UI 프레임워크 | WPF |
| 배포 | 단일 EXE 파일 또는 MSI 설치 프로그램 (MVP: ZIP 배포도 허용) |

---

## 3. 주요 기능 (MVP)

### 3.1 스니펫(키워드 → 대체 텍스트) 관리

- **스니펫 추가**: 키워드(예: `;home`)와 대체 텍스트(예: "서울특별시 ...") 정의
- **스니펫 수정**: 기존 스니펫 갱신
- **스니펫 삭제**: 불필요한 스니펫 제거
- **활성/비활성**: 개별 스니펫을 On/Off 토글

### 3.2 카테고리 관리

- **카테고리 추가/수정/삭제**: 스니펫을 그룹화하기 위한 카테고리 관리
- **카테고리 활성화**: 카테고리 단위로 On/Off 설정 가능
- **규칙**: 카테고리가 Off이면 그 안의 모든 스니펫은 비활성화된 것으로 간주

### 3.3 전역 텍스트 확장

- **범위**: Windows의 모든 텍스트 입력 필드(메모장, 브라우저, 메일 클라이언트 등)에서 동작
- **트리거**: 구분자(스페이스, 엔터, 탭, `. , ! ? : ;`) 입력 시
- **매칭**: 직전 단어를 키워드로 간주하고, 활성 카테고리의 활성 스니펫 목록에서 정확히 일치하는 키워드 검색
- **치환**: 일치하는 스니펫이 있으면 대체 텍스트로 자동 치환

### 3.4 사용자 인터페이스

- **메인 윈도우**: 카테고리 리스트 + 스니펫 리스트 관리 화면
- **상태 표시**: 현재 상태를 "동작 중" 또는 "일시 정지"로 표시
- **전체 토글**: 기능 On/Off 버튼

### 3.5 트레이 아이콘

- **최소화**: 주 윈도우를 시스템 트레이로 최소화
- **우클릭 메뉴**:
  - 열기 (메인 윈도우 표시)
  - 일시 정지 / 재개
  - 종료

---

## 4. 동작 방식 (상세)

### 단계별 처리 흐름

1. **입력 감시**: 전역 키보드 후크(`GlobalKeyboardHook`)로 Windows 전체의 키 입력을 감시
2. **버퍼 관리**: 입력된 문자를 순서대로 내부 버퍼(`StringBuilder`)에 축적
3. **구분자 감지**: 구분자(공백/엔터/탭/구두점)가 입력되면:
   - 버퍼에서 마지막 단어 추출
   - 활성 카테고리의 활성 스니펫 목록에서 키워드 정확 매칭 검색
4. **치환 실행**: 일치하는 스니펫이 있으면:
   - 해당 단어 길이만큼 Backspace 입력 전송 (OS 레벨)
   - 스니펫의 대체 텍스트 입력
   - 사용자가 입력한 구분자 재입력
5. **재귀 방지**: 프로그램이 보내는 키 입력은 `_isSending` 플래그로 구분해 다시 확장 로직에 진입하지 않도록 관리

### 예시 시나리오

**사용자가 입력한 내용:**
```
My address is ;home and my sig is ;sig.
```

**실시간 처리:**
1. `M`, `y`, ` ` → 버퍼에 "My " 쌓임
2. `a`, `d`, `d`, `r`, `e`, `s`, `s` → 버퍼에 "address " 쌓임
3. `i`, `s` → 버퍼에 "is " 쌓임
4. `;`, `h`, `o`, `m`, `e` → 버퍼에 ";home"
5. **스페이스 입력** → ";home" 매칭 찾음 → "서울특별시 강남구..." 로 치환 → 스페이스 다시 입력
6. `a`, `n`, `d` → 계속...
7. `;`, `s`, `i`, `g` → 버퍼에 ";sig"
8. **마침표 입력** → ";sig" 매칭 찾음 → "Best regards, John" 로 치환 → 마침표 다시 입력

**최종 화면:**
```
My address is 서울특별시 강남구... and my sig is Best regards, John.
```

---

## 5. 비기능 요구사항

### 성능 & 리소스

- **가벼움**: 백그라운드에서 상시 동작하므로 CPU/메모리 사용을 최소화
  - 내부 버퍼: 최대 200자 (초과 시 앞부분 제거)
  - 메모리 사용: 평상시 100MB 이하 목표
  - 키 입력 지연: 구분자 입력 후 치환까지 50ms 이내

### 안정성 & 안전성

- **안정성**: 텍스트 확장 실패 시에도 원래 사용자 입력은 그대로 동작해야 함
  - 치환 실패 시 롤백 메커니즘 필요
- **안전성**: 입력 내용을 외부로 전송하지 않음
  - 모든 스니펫 데이터는 로컬 JSON 파일(`%AppData%\TextExpander\snippets.json`)에만 저장
  - 네트워크 통신 금지
- **데이터 손상 방지**: JSON 저장 시 임시 파일 + 원본 백업으로 안전성 확보

### 확장성 & 유지보수

- **향후 기능 추가 고려**:
  - 플레이스홀더 (예: `{date}`, `{time}`, `{clipboard}`)
  - 예외 앱 리스트 (특정 앱에서는 확장 안 함)
  - 단축키 설정 (전역 키 조합으로 활성/비활성 전환)
  - 검색/필터 기능
- **구조**: 도메인 로직을 UI와 완전히 분리하여 나중에 다른 UI(WinUI, MAUI 등)로 변경 가능

---

## 6. 데이터 저장 구조

**파일 경로**: `%AppData%\TextExpander\snippets.json`

**예시 JSON 구조**:
```json
{
  "version": "1.0",
  "categories": [
    {
      "id": "97ac6c3d-3e43-4e95-9f9e-4b5a1d7e12ab",
      "name": "주소",
      "description": "자주 쓰는 주소 모음",
      "isEnabled": true
    },
    {
      "id": "bb37acbf-0102-4b5a-1d7e-3b0c23e5-3f1e",
      "name": "서명",
      "description": "이메일 서명 모음",
      "isEnabled": true
    }
  ],
  "snippets": [
    {
      "id": "3b0c23e5-3f1e-4d40-8e1f-bb37acbf0102",
      "categoryId": "97ac6c3d-3e43-4e95-9f9e-4b5a1d7e12ab",
      "keyword": ";home",
      "replacement": "서울특별시 강남구 테헤란로 123",
      "isEnabled": true,
      "note": "집 주소"
    },
    {
      "id": "5d1e4f7a-2c9b-4a68-9f5c-1a2b3c4d5e6f",
      "categoryId": "bb37acbf-0102-4b5a-1d7e-3b0c23e5-3f1e",
      "keyword": ";sig",
      "replacement": "Best regards,\nJohn Doe\nDeveloper",
      "isEnabled": true,
      "note": "표준 서명"
    }
  ]
}
```

---

## 7. 구분자 정의 (Final)

다음 문자들이 "단어 끝"을 의미하는 구분자로 간주됩니다:

| 구분자 | 설명 |
|--------|------|
| ` ` (U+0020) | 공백 |
| `\t` (U+0009) | 탭 |
| `\r` (U+000D) | 캐리지 리턴 |
| `\n` (U+000A) | 라인 피드 |
| `.` | 마침표 |
| `,` | 쉼표 |
| `!` | 느낌표 |
| `?` | 물음표 |
| `:` | 콜론 |
| `;` | 세미콜론 |

---

## 8. 인수 인계 기준 (Acceptance Criteria)

### Core 기능

- [ ] 스니펫 추가/수정/삭제가 JSON 파일에 정확히 반영
- [ ] 카테고리 On/Off에 따라 스니펫 활성화/비활성화 정확히 작동
- [ ] 전역 키보드 후크가 정상 작동하고 다른 앱과 충돌 없음
- [ ] 구분자 입력 시 마지막 단어가 정확히 추출됨
- [ ] 키워드 정확 매칭으로 스니펫 검색 정상 작동
- [ ] 치환 흐름(Backspace → Replacement → Delimiter) 정상 작동
- [ ] 프로그램이 보낸 키 입력이 재귀로 처리되지 않음

### UI 기능

- [ ] 메인 윈도우에서 카테고리/스니펫 리스트 표시 및 관리 가능
- [ ] On/Off 토글이 정상 작동
- [ ] 트레이 아이콘 우클릭 메뉴 정상 작동
- [ ] 일시 정지/재개 기능 정상 작동

### 비기능

- [ ] 메모리 사용 100MB 이하 (평상시)
- [ ] 키 입력 지연 50ms 이내
- [ ] 24시간 연속 운영 시 안정성 확보
- [ ] JSON 손상 시에도 앱 크래시 없음

---

## 9. 마이그레이션 & 향후 계획

### Phase 2 계획 (v1.1+)

- [ ] 플레이스홀더 지원 (`{date}`, `{time}` 등)
- [ ] 예외 앱 리스트 (확장 안 할 앱)
- [ ] 단축키 글로벌 설정
- [ ] 스니펫 검색/필터 UI
- [ ] 클라우드 동기화 (선택사항)

### 기술 개선 (UI 마이그레이션 고려)

- 현재: WPF 기반
- 향후: WinUI 3 또는 .NET MAUI로 전환 가능하도록 Core 설계 유지
